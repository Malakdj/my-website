<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoKey Cipher Runner</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">


</head>

<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Logo container with house icon and title -->
        <div class="logo-container">
            <h2>AutoKey</h2>
            <a href="index.html">
                <i class="fas fa-home logo"></i>
            </a>
        </div>

        <button onclick="showSlide('definition')" class="active">Definition</button>
        <button onclick="showSlide('howToWork')">How It Works</button>
        <button onclick="showSlide('cryptage')">Encryption</button>
        <button onclick="showSlide('decryptage')">Decryption</button>
    </div>

    <!-- Mobile Menu Button (add near top of body) -->
    <div class="mobile-menu-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </div>
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>



    <!-- Content Area -->
    <div class="content">
        <div class="container">
            <!-- Definition Slide -->
            <div id="definition" class="slide active-slide">
                <div class="centered-content">
                    <h3>Definition</h3>
                    <p>The AutoKey cipher is a type of polyalphabetic cipher that uses a key and part of the plaintext
                        itself to form the full encryption key. It’s stronger than the AutoKey cipher because it avoids
                        repeating keys.
                    </p>

                    <!-- Add an image -->
                    <!-- <img src="imag/AutoKey1.png" alt="AutoKey Cipher Example" class="definition-image"> -->
                </div>
            </div>

            <!-- How to Work Slide -->
            <div id="howToWork" class="slide">
                <div class="centered-content">
                    <h3>How the AutoKey Cipher Works</h3>
                    <p>The AutoKey Cipher is a <b>polyalphabetic substitution cipher</b> that uses a keyword followed by
                        the plaintext itself to create a dynamic key. It was designed to strengthen traditional ciphers
                        like the AutoKey by avoiding repeating key patterns.</p>

                    <h4>Components of the AutoKey Cipher</h4>
                    <ul>
                        <li><b>Alphabet Table</b> – Similar to the AutoKey square (26×26 grid of shifted alphabets).
                        </li>
                        <li><b>Key</b> – Starts with a keyword, then continues with the plaintext itself.</li>
                        <li><b>Plaintext</b> – The original message to be encrypted.</li>
                        <li><b>Ciphertext</b> – The encrypted result.</li>
                    </ul>

                    <h4>Encryption Process</h4>
                    <ol>
                        <li><b>Create the Full Key:</b> Append the plaintext to the end of the keyword until it matches
                            the length of the plaintext.</li>
                        <li><b>Encrypt Each Letter:</b>
                            <ul>
                                <li>Convert the plaintext and full key to positions (A=0 to Z=25).</li>
                                <li>Add the positions and take modulo 26.</li>
                                <li>Convert the result back to a letter to form the ciphertext.</li>
                            </ul>
                        </li>
                    </ol>

                    <h4>Decryption Process</h4>
                    <ol>
                        <li><b>Start with the Key:</b> Begin decryption using the keyword.</li>
                        <li><b>Decrypt Each Letter:</b>
                            <ul>
                                <li>Subtract the key letter's position from the ciphertext letter, add 26, then take
                                    modulo 26.</li>
                                <li>The result gives you the plaintext letter.</li>
                                <li>Append this plaintext letter to the key to continue decryption.</li>
                            </ul>
                        </li>
                    </ol>

                    <h4>Example</h4>
                    <p><b>Plaintext:</b> ATTACKATDAWN<br>
                        <b>Key:</b> QUEEN<br>
                        <b>Full Key:</b> QUEENATTACKA<br>
                        <b>Result:</b> QNXEPVYTWTWP
                    </p>

                    <table border="1"
                        style="width: 80%; text-align: center; background: #252526; color: white; border-collapse: collapse; margin-top: 10px;">
                        <tr style="background: #007acc;">
                            <th>Plaintext Letter</th>
                            <th>Key Letter</th>
                            <th>Ciphertext Letter</th>
                        </tr>
                        <tr>
                            <td>A</td>
                            <td>Q</td>
                            <td>Q</td>
                        </tr>
                        <tr>
                            <td>T</td>
                            <td>U</td>
                            <td>N</td>
                        </tr>
                        <tr>
                            <td>T</td>
                            <td>E</td>
                            <td>X</td>
                        </tr>
                        <tr>
                            <td>A</td>
                            <td>E</td>
                            <td>E</td>
                        </tr>
                        <tr>
                            <td>C</td>
                            <td>N</td>
                            <td>P</td>
                        </tr>
                        <tr>
                            <td>K</td>
                            <td>A</td>
                            <td>V</td>
                        </tr>
                        <tr>
                            <td>A</td>
                            <td>T</td>
                            <td>Y</td>
                        </tr>
                        <tr>
                            <td>T</td>
                            <td>T</td>
                            <td>T</td>
                        </tr>
                        <tr>
                            <td>D</td>
                            <td>A</td>
                            <td>W</td>
                        </tr>
                        <tr>
                            <td>A</td>
                            <td>C</td>
                            <td>T</td>
                        </tr>
                        <tr>
                            <td>W</td>
                            <td>K</td>
                            <td>W</td>
                        </tr>
                        <tr>
                            <td>N</td>
                            <td>A</td>
                            <td>P</td>
                        </tr>
                    </table>

                    <h4>Weaknesses of the AutoKey Cipher</h4>
                    <ul>
                        <li>Still vulnerable if the keyword is short and known.</li>
                        <li>Susceptible to known-plaintext attacks if part of the message is predictable.</li>
                    </ul>

                    <h4>Why It Matters</h4>
                    <p>The AutoKey Cipher improved upon older methods like the AutoKey Cipher by reducing repetition and
                        enhancing complexity, making frequency analysis harder. It was a step toward more modern
                        encryption techniques.</p>
                </div>
            </div>



            <!-- Cryptage Slide -->
            <div id="cryptage" class="slide">
                <h3>AutoKey Cipher Encryption</h3>
                <input type="hidden" id="algorithmName" value="AutoKey"> <!-- Adjust this for each algorithm -->
                <textarea readonly rows="10">
#include <stdio.h>
#include <string.h>
#include <ctype.h>
                        
void encryptAutoKey(char *plaintext, char *key, char *ciphertext) {
    int ptLen = strlen(plaintext);
    int keyLen = strlen(key);
    char fullKey[1000];
                        
    // Step 1: Create the full key (keyword + part of the plaintext)
    strcpy(fullKey, key);
    strncat(fullKey, plaintext, ptLen - keyLen);
                        
    // Step 2: Encrypt each letter
    for (int i = 0; i < ptLen; i++) {
        if (isalpha(plaintext[i])) {
            char p = toupper(plaintext[i]) - 'A';
            char k = toupper(fullKey[i]) - 'A';
            ciphertext[i] = ((p + k) % 26) + 'A';
        } else {
            ciphertext[i] = plaintext[i]; // Keep non-alphabet characters unchanged
        }
    }
    ciphertext[ptLen] = '\0'; // Null-terminate the result
}
                        
int main() {
    char plaintext[1000], key[100], ciphertext[1000];
                        
    printf("Enter plaintext (letters only): ");
    gets(plaintext);
                        
    printf("Enter key: ");
    gets(key);
                        
    encryptAutoKey(plaintext, key, ciphertext);
    printf("Encrypted: %s\n", ciphertext);
                        
    return 0;
}
                            
                        
                </textarea>
                <br>
                <input type="hidden" id="algorithmName" value="AutoKey">
                <label for="key">Enter Key:</label>
                <input type="text" id="key" placeholder="Enter key...">
                <label for="message">Enter Message:</label>
                <textarea id="message" rows="4" placeholder="Enter your message..."></textarea>
                <button onclick="runCipher()">Run</button>
                <!-- Output title under the button -->
                <h2 id="outputTitle">Output:</h2>
                <pre id="output"></pre>
            </div>
            <!-- Decryptage Slide -->
            <div id="decryptage" class="slide">
                <h3>AutoKey Cipher Decryption</h3>
                <textarea readonly rows="10">
#include <stdio.h>
#include <string.h>
#include <ctype.h>
                        
void decryptAutoKey(char *ciphertext, char *key, char *plaintext) {
    int ctLen = strlen(ciphertext);
    char currentKey[1000];
    strcpy(currentKey, key);
                        
    // Step 1: Decrypt each letter using key + recovered plaintext
    for (int i = 0; i < ctLen; i++) {
        if (isalpha(ciphertext[i])) {
            char c = toupper(ciphertext[i]) - 'A';
            char k = toupper(currentKey[i]) - 'A';
            char p = ((c - k + 26) % 26) + 'A';
            plaintext[i] = p;
                        
            // Step 2: Append recovered plaintext to the key
            int len = strlen(currentKey);
            if (len < ctLen) {
                currentKey[len] = p;
                currentKey[len + 1] = '\0';
            }
        } else {
            plaintext[i] = ciphertext[i]; // Keep non-alphabet characters unchanged
        }
    }
    plaintext[ctLen] = '\0'; // Null-terminate the result
}
                        
int main() {
    char ciphertext[1000], key[100], plaintext[1000];
                        
    printf("Enter ciphertext: ");
    gets(ciphertext);
                        
    printf("Enter key: ");
    gets(key);
                        
    decryptAutoKey(ciphertext, key, plaintext);
    printf("Decrypted: %s\n", plaintext);
                        
    return 0;
}
                                                      
                </textarea>
                <br>
                <!-- In the decryption section, change the input IDs to be unique -->
                <label for="keyDecryption">Enter Key:</label>
                <input type="text" id="keyDecryption" placeholder="Enter key...">
                <label for="messageDecryption">Enter Message:</label>
                <textarea id="messageDecryption" rows="4" placeholder="Enter your message..."></textarea>
                <button onclick="runDecryption()">Run</button>
                <h2 id="outputTitle">Output:</h2>
                <pre id="outputDecryption"></pre>
            </div>



        </div>
    </div>


    <script>

        function showSlide(slideId, fromLoad = false) {
            const slides = document.querySelectorAll('.slide');
            slides.forEach(slide => slide.classList.remove('active-slide'));

            document.getElementById(slideId).classList.add('active-slide');

            if (!fromLoad) {
                sessionStorage.setItem('selectedSlide', slideId);
            }

            updateSidebarButtons(slideId);
        }

        function updateSidebarButtons(activeSlide) {
            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.sidebar button');
            buttons.forEach(button => button.classList.remove('active'));

            // Add active class to the clicked button
            const activeButton = document.querySelector(`[onclick="showSlide('${activeSlide}')"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }

        window.onload = function () {
            const currentPage = document.title;
            const lastPage = localStorage.getItem('lastPage');

            if (lastPage !== currentPage) {
                // User came from a different page → reset to first slide
                sessionStorage.removeItem('selectedSlide');
                localStorage.setItem('lastPage', currentPage);
            }

            const savedSlide = sessionStorage.getItem('selectedSlide') || 'definition';
            showSlide(savedSlide, true); // Pass true to indicate this is from page load
        };

        window.addEventListener('beforeunload', function () {
            const navigationType = performance.getEntriesByType("navigation")[0].type;
            if (navigationType === "navigate" || navigationType === "reload") {
                // Keep the slide state for refreshes
                return;
            }
            // Clear for other types of navigation
            sessionStorage.removeItem('selectedSlide');
        });


        function showSlide(slideId) {
            const slides = document.querySelectorAll('.slide');
            slides.forEach(slide => slide.classList.remove('active-slide'));

            document.getElementById(slideId).classList.add('active-slide');
            sessionStorage.setItem('selectedSlide', slideId);

            updateSidebarButtons(slideId);
        }







        function runCipher() {
            const key = document.getElementById("key").value.trim();
            const message = document.getElementById("message").value.trim();
            const algorithm = document.getElementById("algorithmName").value;

            if (!key || !message) {
                document.getElementById("output").textContent = "Please enter both key and message";
                return;
            }

            if (!/^[a-zA-Z]+$/.test(key)) {
                document.getElementById("output").textContent = "Key must contain only letters";
                return;
            }

            fetch("/run", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    algorithm: "autokey", 
                    key: key,
                    message: message
                })
            })
                .then(response => response.text())
                .then(data => document.getElementById("output").textContent = data)
                .catch(error => {
                    console.error("Error:", error);
                    document.getElementById("output").textContent = "Error: " + error.message;
                });
        }

        function runDecryption() {
            const key = document.getElementById("keyDecryption").value.trim();
            const message = document.getElementById("messageDecryption").value.trim();
            const algorithm = document.getElementById("algorithmName").value;

            if (!key || !message) {
                document.getElementById("outputDecryption").textContent = "Please enter both key and message";
                return;
            }

            if (!/^[a-zA-Z]+$/.test(key)) {
                document.getElementById("outputDecryption").textContent = "Key must contain only letters";
                return;
            }

            fetch("/runDecryption", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    algorithm: "autokey", 
                    key: key,
                    message: message
                })
            })
                .then(response => response.text())
                .then(data => document.getElementById("outputDecryption").textContent = data)
                .catch(error => {
                    console.error("Error:", error);
                    document.getElementById("outputDecryption").textContent = "Error: " + error.message;
                });
        }

        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');

            const isActive = sidebar.classList.contains('active');

            if (isActive) {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            } else {
                sidebar.classList.add('active');
                overlay.classList.add('active');
            }
        }

        // Close sidebar on body click or button click inside it (mobile only)
        document.addEventListener('click', function (event) {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            const button = document.querySelector('.mobile-menu-btn');

            const clickedInsideSidebar = sidebar.contains(event.target);
            const clickedButton = button.contains(event.target);

            if (window.innerWidth <= 768 && !clickedInsideSidebar && !clickedButton) {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            }
        });

        // Also close sidebar when any sidebar button is clicked
        const sidebarButtons = document.querySelectorAll('.sidebar button');
        sidebarButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    document.querySelector('.sidebar').classList.remove('active');
                    document.querySelector('.sidebar-overlay').classList.remove('active');
                }
            });
        });


    </script>
</body>

</html>